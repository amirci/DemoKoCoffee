(function(){var t,i,n=function(n,t){return function(){return n.apply(t,arguments)}};DemoKoCoffee.MovieLibraryViewModel=function(){function r(t){this.cancelEditing=n(this.cancelEditing,this),this.saveEditing=n(this.saveEditing,this),this.editTitle=n(this.editTitle,this),this.newMovie=n(this.newMovie,this),this.loadMovies=n(this.loadMovies,this);var r=this;this.title=ko.observable(t),this.movies=ko.observableArray(),this.editingTitle=ko.observable(!1),this.newTitle=ko.observable(),this.count=ko.computed(function(){return r.movies().length}),this.newMovieVM=new i(this.movies),this.loadMovies()}return r.prototype.loadMovies=function(){var n=this;return $.ajax({type:"GET",url:"/movies",success:function(i){var r;return n.movies(function(){var n,e,u,f;for(u=i.movies,f=[],n=0,e=u.length;n<e;n++)r=u[n],f.push(new t(r));return f}())},error:function(){return console.log("Error calling /movies!")}})},r.prototype.newMovie=function(){return this.newMovieVM.active(!0)},r.prototype.editTitle=function(){return this.newTitle(this.title()),this.editingTitle(!0)},r.prototype.saveEditing=function(){return this.title(this.newTitle()),this.editingTitle(!1)},r.prototype.cancelEditing=function(){return this.editingTitle(!1)},r}(),i=function(){function i(t){this.movies=t,this.cancel=n(this.cancel,this),this.save=n(this.save,this),this.activate=n(this.activate,this),this.active=ko.observable(!1),this.title="",this.relDate="",this.active.subscribe(this.activate)}return i.prototype.activate=function(n){if(n)return this.relDate=this.title=""},i.prototype.save=function(){return this.active(!1),this.movies.push(new t({title:this.title,releaseDate:new Date(this.relDate)}))},i.prototype.cancel=function(){return this.active(!1)},i}(),t=function(){function n(n){var t=this;ko.mapping.fromJS(n,{},this),this.releaseDate=ko.computed(function(){return $.format.date(new Date(t.releaseDate()),"MMM dd yyyy")})}return n}()}).call(this)